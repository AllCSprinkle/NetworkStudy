## 프로토콜
프로토콜이란 기기가 인터넷에서 서로 어떻게 통신해야 하는지, 오류가 발생했을 때 무엇을 해야하는지에 관한 규칙이다.
같은 종류의 통신에도 다양한 프로토콜 유형이 사용된다.
대표적으로 TCP, UDP, QUIC 가 있다.


## TCP(Transmission control Protocol)
패킷을 정확하고 완전한 형태로 전송하지만, 다른 프로토콜에 비해 보내는 속도가 느리다.

## UDP(User Datagram Protocol)
정확한 패킷 전달이나 전송 순서보다 속도를 우선시하는 프로토콜이다.

## QUIC(Quick UDP Internet Connections)
여러 개의 빠른 UDP 연결을 활용하지만, TCP처럼 정확하고 신뢰할 수 있는 방식으로 전송한다.


## 인터넷 프로토콜(IP)
IP는 패킷을 어떻게 구성할 것인지, 그리고 패킷을 목적지까지 보낼 주소를 어떻게 저장할 것인지를 표준화하는 프로토콜이다.
인터넷상의 다른 기기와 소통하려면 주소 형식이 반드시 인터넷 프로토콜 표준을 따라야 한다.

이 표준을 따른 네트워크 주소를 "IP 주소"라 부른다.


## 공용 및 사설 IP 주소
인터넷 프로토콜은 다음과 같은 주소 유형을 호출한다.


## 공통 IP주소

인터넷에 직접 접속할 수 있는 경우다.
인터넷 서비스 공급자(ISP)가 제공하는 홈 라우터는 공용 IP를 갖고 있다.
사설 IP 주소

인터넷에 직접 접속할 수는 없지만, 중개자를 통해 접속할 수 있는 경우다.
- 홈 라우터에 연결된 각 디바이스가 사설 IP주소에 해당한다.
- 사설 IP로는 일반적으로 광역 인터넷에 바로 접속할 수 없고, 근거리 통신망 (LAN)이나 가상 사설망의 (VPN) 등의 사설망에서만 접속할 수 있다.

홈 라우터는 공용 IP 주소가 있지만 그 집에서 일어나는 패킷 전송도 처리한다.
이 말은 집 안에 있는 사설망에 연결된 홈 라우터가 사설 IP 주소를 사용하는 디바이스의 중개자 역할도 하고 있다는 뜻이다.

같은 네트워크에서는 여러 기기가 한 주소를 동시에 사용할 수 없다.
그래서 각자 IP 주소 역시 중복 없이 전 세계에서 단 하나씩만 존재한다.


## 네트워크 주소 변환(NAT)
인터넷 사설망이 연결되고 라우터를 거쳐 패킷을 보낼 때, 라우터는 네트워크 주소 변환 이라는 기술을 활용해서 패킷의 주소 형식을 다시 작성한다.
간단히 말하면 망 안에서만 통하는 사설 IP 주소를 바깥에서 쓸 수 있는 공용 IP 주소로 바꿔주는 거다.
NAT을 사용하는 경우, 라우터는 패킷을 보낸 쪽의 정보를 모두 메모리에 저장한다.
네트워크가 인터넷으로부터 응답을 받으면 라우터는 전달받은 패킷 태그를 다시 작성한다.

사설 IP를 사용하는 여러 디바이스가 라우터의 공용 IP를 빌려 인터넷에 접속하는 과정이라고 이해하면 된다.
단, 라우터 전원이 꺼지면 이 모든 정보는 사라진다.


## IPV4 주소
IP 주소를 효율적으로 배정하려고 클래스라는 개념을 도입했다. 클래스에는 A, B, C, D, E 다섯 종류가 있다. 클래스는 IP 주소의 맨 처음 바이트의 시작 1비트가 0 으로 시작하면 A 클래스, 시작 2비트가 10 으로 시작하면 B 클래스, 시작 3비트가 110 으로 시작하면 C 클래스, 시작 4비트가 1110 으로 시작하면 D 클래스, 시작 4비트가 1111 로 시작하면 E 클래스로 분류한다.

|클래스|범위|범위|
|---|---|----|
|A|0.0.0.0 ~|127.255.255.255|
|B|128.0.0.0 ~|191.255.255.255|
|C|192.0.0.0 ~|223.255.255.255|
|D|224.0.0.0 ~|239.255.255.255|
|E|240.0.0.0 ~|255.255.255.255|

- A Class 인 경우는 첫 번째 bit 는 항상 0 이며, 따라서 첫 번째 필드의 값은 0 ~ 127 까지 가능하다. 하지만 0.0.0.0 은 사용하지 않는 주소이고, 127.×.×.× 는 시스템 루프백 주소(가상으로 할당한 인터넷 주소)라서 사용하지 않는다. 따라서 실제로 사용하는 주소는 1 ~ 126 까지로, 1.0.0.0 ~ 126.255.255.255 가 된다. 호스트 주소는 24bit 를 활용할 수 있으므로 224 - 2(호스트 주소가 모두 0 인 것과 모두 1 인 것은 특별한 의미가 있는 주소로 예약되어 있다.), 16,777,214 개의 호스트들에게 주소 할당이 가능하다.

- B Class 인 경우는 처음 2개의 bit 가 1, 0 이기 때문에 첫 번째 필드의 값은 128 ~ 191 까지 가능하다. Host 주소는 16bit 를 사용할 수 있으므로 216 - 2, 65,534 개의 호스트들에게 주소 할당이 가능하다.

- C Class 인 경우는 처음 3개의 bit 가 1, 1, 0 이기 때문에 첫 번째 필드의 값은 192 ~ 233 까지 가능하다. Host 주소는 8bit 를 사용할 수 있으므로 28 - 2, 254 개의 호스트들에게 주소 할당이 가능하다.

- D Class 는 멀티캐스트(데이터 수신 대상이 네트워크에 연결된 일부 컴퓨터) 주소로 사용하기 위한 용도로 설계되었고, E Class 는 나중에 사용하기 위해 예약되어 있다. 255.255.255.255  전체 컴퓨터에 대한 브로드캐스트(네트워크에 연결된 전체 컴퓨터를 수신 대상으로 하는) 주소로 사용한다. 따라서 IPv4 가 실무에서 주로 사용하는 것은 A, B, C 클래스이다.

## IPV6 주소
현재 사용하는 IP 버전은 4 로, IPv4 로 표현한다. IPv4 주소는 32비트로 구성되며, 네트워크 ID 와 호스트 ID 부분으로 나뉘어 있다. 또한 2-level 주소 구조(Net ID, Host ID)로 되어 있다. IP 는 네트워크 규모에 따라 세 가지 규모의 클래스에 멀티캐스트 클래스와 예약된 클래스를 합한 총 다섯 가지 클래스로 구성되어 있다. IPv4 주소는 산술적으로 주소를 43억 개 할당할 수 있지만, 클래스 별 주소 분류 방식 때문에 사용하지 않는 주소가 많다. 유비쿼터스 시대에는 각각의 단말기마다 IP 가 부여되는 환경이 필요하므로 기존 IPv4를 사용하면 IP 주소가 부족할 것이다.

IPv6 은 128비트로 구성되며, 긴 주소를 쉽게 읽을 수 있도록 16비트씩 :(콜론)으로 나누어 각 필드를 16 진수로 표현하는 방법을 사용한다. 기존 IPv4 주소도 IPv6 주소로 표현할 수 있는데, 하위 32비트에는 IPv4 주소를 그대로 채우고 상위 비트는 모두 0으로 채우는 방식을 사용한다.

### IPV6 주소 체계
IPv6 주소는 16바이트(128비트)로 구성되며, 주소를 읽기 쉽도록 16진수 콜론으로 표현한다. 128비트는 길이가 2바이트인 영역 여덟 개로 나뉘며, 16진수 표기법에서 2바이트는 16진수 네 개로 표현하여 전체적으로 16진수 32개로 표현한다.
```
FDCB:BA78:0005:2340:BBFF:0000:ASDD:FFFF
```
128비트 IP 주소는 단축해서 표현할 수 있는데, 콜론 두 개 사이에 있는 수(섹션) 네 개에서 앞쪽의 0은 생략할 수 있다. 이런 생략 방식을 이용하면 0056은 56으로, 000D는 D로 0000은 0으로 표기할 수 있다.

```
FDCB:BA78:5:2340:BBFF:0:ASDD:FFFF
```
8개의 영역 중에서 0000 인 영역이 연속적으로 나타나는 경우에는 해당 영역들을 생략할 수 있지만, 주소 당 한 번만 허용된다. 아래 그림에서 전체 영역의 개수가 8 이어야 하므로 :: 은 생략된 4개의 영역을 의미하지만, 0000 인 영역이 두 번 이상 생략이 되는 경우에는 원래의 영역 형태로 복원이 불가능하여 사용할 수 없게 된다.
```
FDCB:0:0:0:0:ASDD:0:FFFF
```
변환 후
```
FDCB::ASDD:0:FFFF
```
브로드캐스트 주소는 더 이상 허용되지 않으며, 새로운 개념인 애니캐스트 주소가 추가되어 유니캐스트 주소와 애니캐스트 주소, 멀티캐스트 주소가 사용된다.


## IP 라우팅
패킷은 패킷 헤더라는 태그가 달려있다. 태그에는 수신 및 발신 주소의 정보가 포함되어 있으므로 패킷이 어디에서 와서 어디로 가는지 알 수 있다.

라우터는 전용회선을 통해 LAN에 연결된 컴퓨터들이 동시에 인터넷을 사용할 수 있게 해주는 장비로 데이터를 목적지까지 전달하는 기능을 수행하며 2개 이상의 서로 다른 네트워크를 접속하고 이들 간 데이터를 주고 받게하는 중계 기능도 한다. 대부분의 라우터는 IP 라우팅 기능뿐 아니라 LAN용 프로토콜인 IPX, AppleTalk등의 브리징 기능도 함께한다.

즉, `라우터는 IP네트워크, 서브넷을 관리하면서 다른 네트워크를 거쳐 패킷을 전송하는 역할을 하는 장비`이고, `라우팅은 그 패킷을 보낼 경로를 선택하는 과정`이라고 볼 수 있다.


### 라우터의 목적지 학습 방법
1. Connected (연결)

자신과 물리적으로 직접 연결되어있는 장비의 IP 주소를 자동으로 알아온다. 이때 IP는 네트워크 주소로 라우팅 테이블에 저장된다.

2. Static (정적)

관리자가 직접 라우팅 경로를 선택해서 보내는 설정.

장점 : 관리자가 테이터가 전송될 경로를 직접 설정하므로 경로관리에 가장 효율적이다.

단점 : 네트워크 변화에 대한 대처가 느리다.

3. Dynamic (동적)

각 라우터들이 갖고 있는 정보를 서로에게 공유하여 라우팅 테이블에 저장한다. 주시적으로 최적경로를 계산하여 라우팅 테이블의 정보를 유지하는 방식이다.

장점 : 네트워크 변화에 대한 대처가 빠르다.

단점 : 주기적으로 경로를 계산해야하므로 리소스 소비량(CPU사용량)이 많아진다.


## 인터넷 프로토콜 보안(IPSec)

* IPsec는 Internet Protocol Security의 약자이다.
* Network layer에서 IP패킷을 암호화하고 인증하는 등의 보안을 위한 표준이다.
* 안전한 인터넷 프로토콜(IP) 통신을 위한 인터넷 프로토콜들의 모음이다.
* IPSec가 제공하는 보안 서비스의 범위는 호스트나 보안게이트웨이 사이이다.
* VPN을 구현하는데 사용되는 프로토콜이기도 하다.

즉 한마디로 정리해보면, `network layer에서 IP 패킷을 보호하기 위해서 만들어진 프로토콜 표준의 프레임워크`이다.

참고로 IPv4에서는 선택적으로 사용되었지만, IPv6부터는 기본 스펙으로 들어가게 된다. (애초에 IPv6를 위해 만들어졌다)

또한, 대부분의 VPN 서버와 클라이언트는 IPsec의 표준을 따른다.

### IPsec의 기능

1. Confidentiality
암호화를 통해 기밀성을 제공한다.

2. Integrity
HMAC을 통해 무결성을 제공한다.

3. Origin Authentication
올바른 송신자로부터 온 것인지를 확인하는 송신자 인증을 제공한다.

4. Anti-replay protection
재전송 공격(replay attack)을 막아준다.

5) Access control
보안정책(SP)로 패킷 접근 제어한다.

6. Limited Traffic Flow Confidentiality
패킷의 출발지와 도차지 정보를 제한적으로 암호화한다.

 